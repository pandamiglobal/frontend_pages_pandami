# Tasks: Public Profile View Page

<!-- Generated by /speckit.tasks -->

## Phase 1 – Setup

- [X] T001 Configure public profile route folder structure in `src/app/p/[public-profile]/` (page.tsx, layout.tsx, loading.tsx)
- [X] T002 Ensure SWR and required UI libraries (Tailwind, shadcn/ui, Lucide) are installed and configured for this project
- [X] T003 Create base public profile feature folder structure in `src/app/_components/pages/public-profile/` (page, model, components subfolders)
- [X] T004 Verify existing server action or API client for `GET /public-profile/{slug}` (`src/server/actions/get-public-profile.action.ts`) is available and aligned with spec

## Phase 2 – Foundational (Shared for all stories)

- [X] T005 Define or reuse TypeScript types for public profile domain in `src/types/IPublicProfile.ts` (ensure alignment with SaaS module)
- [X] T006 Create SWR data fetching hook `src/hooks/use-public-profile.ts` using `get-public-profile.action.ts` and `IPublicProfileFullResponse`
- [X] T007 Implement error and loading state model for public profile hook (success, not-found, error, loading) in `src/hooks/use-public-profile.ts`
- [X] T008 Implement base layout for public routes in `src/app/(public)/layout.tsx` (no auth, basic shell)
- [X] T009 Implement layout wrapper for `/p` routes in `src/app/(public)/p/layout.tsx` (shared header/footer slots)
- [X] T010 Implement public profile page layout in `src/app/p/[public-profile]/layout.tsx` (plugs in simplified header + footer with WhatsApp CTA + fixed bar container)
- [X] T011 Implement route-level loading skeleton for public profile in `src/app/p/[public-profile]/loading.tsx` reusing skeleton components from SaaS (`MySiteProfileHeaderSkeleton`) adapted to public context

## Phase 3 – User Story 1 (P1): View Professional Profile Information

Goal: Allow users to view core professional profile information (name, bio, services, business hours, contact info) at `/p/{slug}`.

- [X] T012 [US1] Implement server component `src/app/p/[public-profile]/page.tsx` that resolves slug, calls server action, and passes data to client view component
- [X] T013 [US1] Create client view component `src/app/_components/pages/public-profile/public-profile-page/public-profile-page.view.tsx` reusing SaaS `MySitePageView` card layout patterns, but rendered as a single-page layout (no tab navigation, all sections/cards stacked on the same page, and without any editing or settings UI)
- [X] T014 [US1] Create model hook `src/app/_components/pages/public-profile/public-profile-page/public-profile-page.model.ts` based on `useMySitePage` but read-only (no modals, no mutation handlers, no isEditable state)
- [X] T015 [US1] Adapt profile header wrapper `profile-header-wrapper.tsx` in `src/app/_components/pages/public-profile/public-profile-page/wrappers/` to consume public profile model (no edit handlers)
- [X] T016 [US1] Adapt services section wrapper `services-section-wrapper.tsx` to display services list in read-only mode (no add/edit/delete buttons) in `.../public-profile-page/wrappers/services-section-wrapper.tsx`
- [X] T017 [US1] Adapt information wrapper `information-section-wrapper.tsx` to display location, phone, and business hours in read-only mode (no edit buttons) in `.../public-profile-page/wrappers/information-section-wrapper.tsx`
- [ ] T018 [P] [US1] Implement reusable profile header component for public view in `src/app/_components/pages/public-profile/components/profile-header/profile-header.tsx` mapped from SaaS `MySiteProfileHeader` but with `isEditable` hardcoded to false
- [ ] T019 [P] [US1] Implement services list component in `src/app/_components/pages/public-profile/components/services-list/services-list.tsx` based on SaaS SectionCard service variant, without management actions
- [ ] T020 [P] [US1] Implement business hours list component in `src/app/_components/pages/public-profile/components/business-hours/business-hours.tsx` reusing SaaS layout
- [X] T021 [US1] Wire conditional rendering for empty states (no services, no business hours) in public-profile view per spec edge cases
- [X] T022 [US1] Ensure respect of visibility flags for phone/address at model level (`show_phone`, `show_address`) and that hidden data is not rendered in DOM

## Phase 4 – User Story 2 (P2): View Professional Social and Custom Links

Goal: Show social media and custom links in the public profile.

- [X] T023 [US2] Extend public profile model in `public-profile-page.model.ts` to expose social media and custom links from `IPublicProfileFullResponse`
- [X] T024 [P] [US2] Adapt SocialMediaSectionWrapper into a public variant in `.../public-profile-page/wrappers/information-section-wrapper.tsx` (no edit/delete buttons)
- [X] T025 [P] [US2] Implement social links component in `src/app/_components/pages/public-profile/components/social-links/social-links.tsx` (Instagram, TikTok, LinkedIn, WhatsApp) with platform icons and safe external links
- [X] T026 [P] [US2] Adapt CustomLinksSectionWrapper into a public custom-links component in `src/app/_components/pages/public-profile/components/custom-links/custom-links.tsx` respecting `show_links` visibility and URL sanitization
- [X] T027 [US2] Ensure malformed social/custom URLs are validated and hidden (or safely corrected) according to spec edge cases

## Phase 5 – User Story 3 (P2): Contact Professional via WhatsApp

Goal: Allow users to quickly contact the professional via WhatsApp.

- [X] T028 [US3] Implement WhatsApp footer button component in `src/app/_components/molecules/footer-bar/footer-whatsapp-button.tsx` that builds proper WhatsApp link from phone
- [X] T029 [US3] Connect footer WhatsApp button into public profile layout in `src/app/p/[public-profile]/layout.tsx` using phone from public profile model
- [X] T030 [P] [US3] Implement helper utility to generate WhatsApp URL from E.164/BR local phone in `src/lib/utils/build-whatsapp-link.ts`
- [X] T031 [US3] Ensure WhatsApp Web fallback works on desktop browsers (correct URL scheme)
- [X] T032 [US3] Ensure WhatsApp social link (from social media data) also uses the same helper and opens correctly

## Phase 6 – User Story 4 (P3): View Payment Methods

Goal: Display accepted payment methods for the professional.

- [X] T033 [US4] Extend public profile model to map payment methods from `IPublicProfilePaymentMethod[]` into view-friendly structure in `public-profile-page.model.ts`
- [X] T034 [P] [US4] Implement payment methods component in `src/app/_components/pages/public-profile/components/payment-methods/payment-methods.tsx` reusing SaaS `PaymentMethodsList` layout but read-only
- [X] T035 [US4] Integrate payment methods section into public profile view in `public-profile-page.view.tsx` under services or information section per design

## Phase 7 – User Story 5 (P1): Handle Invalid or Non-existent Profiles

Goal: Provide graceful error handling and UX for invalid slugs and API errors.

- [X] T036 [US5] Implement not-found handling in `src/app/p/[public-profile]/page.tsx` using Next.js `notFound()` pattern when server action returns 404 or empty profile
- [X] T037 [US5] Implement custom not-found UI in `src/app/p/[public-profile]/not-found.tsx` with friendly message "Profile not found"
- [X] T038 [US5] Implement error boundary or error UI for API failures in `src/app/p/[public-profile]/error.tsx` with retry button that revalidates SWR cache
- [X] T039 [US5] Ensure slow API or partial loading shows skeleton first and then error after timeout according to spec edge cases

## Phase 8 – Polish & Cross-Cutting Concerns

- [ ] T040 Refine responsive layout and spacing for mobile-first design in all public-profile components under `src/app/_components/pages/public-profile/`
- [ ] T041 Ensure there are no edit/admin actions rendered in DOM (no buttons, no modals) in public profile path
- [ ] T042 [P] Add unit tests for `use-public-profile` hook and model mapping in `__tests__/unit/use-public-profile.test.ts`
- [ ] T043 [P] Add unit tests for public profile page rendering (happy path, empty states, not-found) in `__tests__/unit/public-profile-page.test.tsx`
- [ ] T044 [P] Add basic e2e test for `/p/[public-profile]` happy path and 404 in `__tests__/e2e/public-profile.spec.ts`
- [ ] T045 Run lint and test suite, fix any issues related to new files

## Dependencies & Execution Order

1. Complete Phase 1 (Setup) before any other phases.
2. Phase 2 (Foundational) must be completed before starting any user-story-specific phases.
3. Within user stories, parallel tasks `[P]` may be executed concurrently when touching different files.
4. For MVP, implement fully: US1 (Phase 3) and US5 (Phase 7) after Setup + Foundational.

## Parallel Execution Examples

- T018, T019, T020 can run in parallel once model (T014) shape is defined.
- T024, T025, T026 can run in parallel once social/custom link data is exposed from model (T023).
- T042, T043, T044 can run in parallel after core implementation is stable.
